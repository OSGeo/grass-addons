<h2>DESCRIPTION</h2>
<h3>WARNING: I.EODAG IS UNDER DEVELOPMENT. THIS IS AN EXPERIMENTAL VERSION.</h3>

<em>i.eodag</em> allows to search and download imagery scenes, e.g. Sentinel,
Landsat, and MODIS, from a number of different providers.
The module utilizes the
<a href="https://eodag.readthedocs.io/en/stable/">EODAG API</a>,
as a single interface to search for scenes on the providers that EODAG supports.


<p>
Currently, only products which footprint intersects the current computational
region extent (area of interest, AOI) are retrieved.

<p>
To only list available scenes, <b>l</b> flag must be set. If no <b>start</b>
or <b>end</b> dates are provided, the module will search scenes from the
past 60 days.

<p>
To download all scenes found within the time frame provided, the user must
remove the <b>l</b> flag and provide an <b>output</b> directory. Otherwise,
files will be downloaded into <em>/tmp</em> directory.
To download only selected scenes, one or more IDs must be provided
through the <b>id</b> option.

<p>
To be able to download data through <em>i.eodag</em>, the user will
need to register for the
providers of interest.
<em>i.eodag</em> reads the user credentials, which the user should have
acquired, from the EODAG YAML config file.  User have to specify the config
file path location through the <b>config</b> option, otherwise <em>i.eodag</em>
will use the credentials found in the default config file
<em>~/.config/eodag/eodag.yml</em>

<h2>NOTES</h2>
<h3>Querying</h3>
<p>
Querying, aka. Filtering, is a method introduced to i.eodag to filter search
results based on an extended list of Products' properties, called
<a href="https://eodag.readthedocs.io/en/stable/notebooks/api_user_guide/4_search.html?highlight=queryables#Queryables">queryables</a>.<br>
The <b>print</b> option can be used to get hint of the avaible queryables,
refere to <a href="#list_queryables_example">examples</a>.<br>
For example, to get the queryables for the product "S2_MSI_L2A" that is
offered by Copernicus Data Space Ecosystem, aka. "cop_dataspace":
<div class="code"><pre>
i.eodag print=queryables provider=cop_dataspace producttype=S2_MSI_L2A
</pre>
</div>
Note that the <b>print</b> option only gives a subset of the avaible queryables,
and you can in fact use any of the product's properties, for filtering.
If you are not sure about the all the available properties,
you can run a generic search with the <b>j</b> flag and setting <b>limit=1</b>,
to see an instance of the product of interest.
The available queryables will be found in
the JSON output in the "properties" section.

<p>
<h4>The possible types of these parameters are:</h4>
<ul>
  <li><b>str</b> most common type.</li>
  <li><b>int</b> may have a specified range, e.g. the above cloudCover
    queryable.</li>
  <li><b>float</b> may have a specified range.</li>
  <li><b>Literal</b> has a list of options to choose from.</li>
</ul>

<p>
The <b>query</b> option is used for querying. There is a list of rules that you
need to follow when composing your queries:
<h4>Operators</h4>
<table border="1">
<thead>
<tr>
<th>Relation</th>
<th>Operator</th>
</tr>
</thead>
<tbody>
<tr>
<td>Equal</td>
<td style="text-align: center"><code>eq</code></td>
</tr>
<tr>
<td>Not Equal</td>
<td style="text-align: center"><code>ne</code></td>
</tr>
<tr>
<td>Less Than or Equal</td>
<td style="text-align: center"><code>le</code></td>
</tr>
<tr>
<td>Less Than</td>
<td style="text-align: center"><code>lt</code></td>
</tr>
<tr>
<td>Greater Than or Equal</td>
<td style="text-align: center"><code>ge</code></td>
</tr>
<tr>
<td>Greater Than</td>
<td style="text-align: center"><code>gt</code></td>
</tr>
</tbody>
</table>

<h3>Query Structure</h3>

<h4>Basic Structure:</h4>
<div class="code"><pre>
{queryable} = {value} \ {operator}
</pre></div>
<h4>Example</h4>
Print products whose <b>orbitDirection</b> property equals "DESCENDING":
<div class="code"><pre>
i.eodag -l start=2022-05-01 end=2022-06-01 \
provider=cop_dataspace producttype=S2_MSI_L2A \
query="orbitDirection=DESCENDING\eq"
</pre></div>
NOTE: If no operator is specified then the 'eq' opeartor will be used
<b>(default)</b>.

<h4>Multiple Values per Queryable:</h4>
<div class="code"><pre>
{queryable} = {value_1} \ {operator_1} | {value_2} \ {opeartor_2}
</pre></div>

<h4>Examples</h4>

Print products whose <b>cloudCover</b> is either less than 30 <b>OR</b> greater
than 60, aka. [0, 30) &cup; (60, 100].<br>
Notice here that multiple values are used to indicate the <b>OR relation</b>.
<div class="code"><pre>
i.eodag -l start=2022-05-01 end=2022-06-01 \
provider=cop_dataspace producttype=S2_MSI_L2A \
query="cloudCover=30\lt | 60\gt"
</pre></div>

To use the <b>AND relation</b> instead, write them in seperate queries,
as in the following example.<br>
Print products whose <b>cloudCover</b> are greater than 30 <b>AND</b>
less than 60, aka. (30, 60).
<div class="code"><pre>
i.eodag -l start=2022-05-01 end=2022-06-01 \
provider=cop_dataspace producttype=S2_MSI_L2A \
query="cloudCover=30\gt, cloudCover=60\lt"
</pre></div>

Print products whose <b>cloudCover</b> is Greater Than 30 <b>AND</b> Less Than
60, and having a descending orbit direction.
<div class="code"><pre>
i.eodag -l start=2022-05-01 end=2022-06-01 \
provider=cop_dataspace producttype=S2_MSI_L2A \
query="cloudCover=30\gt, cloudCover=60\lt, orbitDirection=DESCENDING"
</pre></div>

<h4>Null Values</h4>
In some cases, products might have <b>Null</b> as the value of a some properties
(aka. queryables).
In these cases, if you attempt to filter with a queryable the products having
this queryable set as <b>Null</b> will be filtered out.
In case you don't want them to be filtered out, you will have to give
an additional <b>Null</b> value to the queryable.

<h4>Examples</h4>
Print products whose <b>orbitDirection</b> is and only is <b>DESCENDING</b>.
<div class="code"><pre>
i.eodag -l start=2022-05-01 end=2022-06-01 \
provider=cop_dataspace producttype=S2_MSI_L2A \
query="orbitDirection=DESCENDING"
</pre></div>
Print products whose <b>orbitDirection</b> is <b>DESCENDING OR Null</b>.
<div class="code"><pre>
i.eodag -l start=2022-05-01 end=2022-06-01 \
provider=cop_dataspace producttype=S2_MSI_L2A \
query="orbitDirection=DESCENDING|Null"
</pre></div>



<h4>List of Frequently Used Queryables</h4>
<ul>
  <li><b>cloudCover</b> [0, 100]</li>
  <li><b>orbitNumber</b></li>
  <li><b>orbitDirection</b></li>
  <li><b>storageStatus</b></li>
  <li><b>start</b> ISO formated date referring to products caputred on
    start date or later.</li>
  <li><b>end</b> ISO formated date referring to products caputred on
    end date or earlier.</li>
</ul>

<p>
<b>NOTE: These queryables are only for reference,
  and they might not always be avaiable for all providers/products.</b>

<h3>Use Cases</h3>
There are multiple use cases for <em>i.eodag</em> described below:
<h4>Searching from Scratch</h4>
<p>
This is when you are searching for scenes for the first time and you don't
know the IDs of the scenes you are looking for.
The searching is done by setting the main options e.g. <b>producttype</b>,
<b>start</b>, <b>end</b>, and, possibly, a <b>provider</b>.

<h4>Searching using Scenes IDs</h4>
<p>
The use case is that you have a set of scenes IDs that you want to
search for and download.
You are able to do that through two methods:
<ol>
  <li>Use the <b>id</b>.</li>
  <li>Use the <b>file</b> with a text file, having one ID per line.
</ol>
In both cases you can either specify a provider, or not.
In case you don't specify the provider, products might be offered
from different providers.

<h4>Reading Products from a GeoJSON File</h4>
<p>
This use case is used if you have already done your searching,
and you have a GeoJSON file produced by <em>i.eodag</em> using
the <b>save</b> option. To do that you will have to use the <b>file</b>
option and pass the GeoJSON file to it. No additional searching will be
done in this case, but you will be able to further filter the products
saved in the GeoJSON file through the different options,
e.g. <b>start, end, query, area_relation, etc...</b>
<p>
<h4>Filtering by AOI</h4>
When filtering scenes through the area related options
(<b>area_relation</b> and/or <b>minimum_overlap</b>),
<em>i.eodag</em> expects you to provide an
<b>AOI</b> (Area of Interest), by providing a vector map from the current
mapset, through the <b>map</b> option. In case you didn't provide an <b>AOI</b>,
<em>i.eodag</em> will automatically use the <b>current computational region</b>
to do the searching instead. That provides a more flexible approach in regard
of specifying the <b>AOI</b> as you could modify the <b>current
computationl region</b> through
<a href="https://grass.osgeo.org/grass83/manuals/g.region.html">g.region</a>.

<h2>EODAG Configuration</h2>
<p>
EODAG configuration <b>YAML</b> file is used to set multiple values, including:
<p>
<dl>
<dt><b>Priority</b>
<dd>Used when the <em>i.eodag</em> tries to search for a product,
with no <b>provider</b> specified. Searching is attempted with providers
with higher priority first.

<p>
<dt><b>Credentials</b>
<dd>Some providers require credentials to conduct searching,
while others don't. However, you will need to set the credentials for downloading, in most cases.<br>
See
<a href="https://eodag.readthedocs.io/en/stable/getting_started_guide/register.html" target="_blank">
  Providers Registration</a> for more details about registration and credentials.
<p>
NOTE: If you notice that <em>i.eodag</em> doesn't recognize
a specific provider when searching or downloading,
it might be that you need to specify the providers credentials.

<p>
<dt><b>Output Prefix</b>
  <dd>Setting the output_prefix is similar to using the <b>output</b> option. It is the directory into which downloaded scenes will be saved.
</dl>

<p>
Following is an example for a config YAML file with <em>Copernicus
  Dataspace</em> credentials:
<div class="code"><pre>
cop_dataspace:
    priority: # Lower value means lower priority (Default: 0)
    search:   # Search parameters configuration
    download:
        extract:
        outputs_prefix:
    auth:
        credentials:
          username: email@email.com
          password: password
</pre></div>


<p>
See <a href="https://eodag.readthedocs.io/en/stable/getting_started_guide/configure.html" target="_blank">
  Configure EODAG</a>
section for more details about configuration of the
providers' credentials and other EODAG YAML config file parameters.

<h2>EXAMPLES</h2>

Search and list the available Sentinel 2 scenes in the Copernicus Data Space
Ecosystem, using a Vector Map as an AOI:

<div class="code"><pre>
v.extract input=urbanarea where="NAME = 'Durham'" output=durham

i.eodag -l start=2022-05-01 end=2022-06-01 \
    map=durham producttype=S2_MSI_L2A provider=cop_dataspace
<pre></div>

Search and list the available Sentinel 2 scenes in the Copernicus Data Space
Ecosystem, with at least 70% of the AOI covered:
<div class="code"><pre>
v.extract input=urbanarea where="NAME = 'Durham'" output=durham

i.eodag -l start=2022-05-01 end=2022-06-01 \
    producttype=S2_MSI_L2A provider=cop_dataspace \
    clouds=50 map=durham minimum_overlap=70
<pre></div>

Sort results, descendingly, by <b>cloudcover</b>,
and then by <b>ingestiondate</b>
Note that sorting with <b>cloudcover</b> use
unrounded values, while they are rounded to the nearest integer when listing.

<div class="code"><pre>
i.eodag -l start=2022-05-25 end=2022-06-01 \
    producttype=S2_MSI_L2A provider=cop_dataspace \
    sort=cloudcover,ingestiondate order=desc
<pre></div>

Search for scenes with a list of IDs text file, and filter the results with the
provided parameters:

<div class="code"><pre>
i.eodag -l file=ids_list.txt \
    start=2022-05-25 \
    area_relation=Contains clouds=3
<pre></div>

Search and list the available Sentinel 2 scenes in the Copernicus Data Space
Ecosystem, with relative orbit number 54:

<div class="code"><pre>
i.eodag -l producttype=S2_MSI_L2A \
    provider=cop_dataspace save=search_result.geojson \
    query="relativeOrbitNumber=54"
<pre></div>

Download all available scenes with cloud coverage not exceeding 50%
in the tmp directory:

<div class="code"><pre>
i.eodag start=2022-05-25 end=2022-06-01 \
    producttype=S2_MSI_L2A provider=cop_dataspace clouds=50
<pre></div>

Download only selected scenes from a text file of IDs, using the Copernicus Data
Space Ecosystem as the provider:

<div class="code"><pre>
i.eodag file=ids_list.txt provider=cop_dataspace
<pre></div>

Download and extract only selected scenes into the <em>download_here</em>
directory, using a custom config file:

<div class="code"><pre>
i.eodag -e provider=cop_dataspace \
    id="S2B_MSIL2A_20240526T080609_N0510_R078_T37SDD_20240526T094753,
    S2B_MSIL2A_20240529T081609_N0510_R121_T37SED_20240529T124818" \
    config=full/path/to/eodag/config.yaml \
    output=download_here
<pre></div>

List recognized eodag providers:
<div class="code"><pre>
i.eodag print=providers
<pre></div>

List recognized eodag providers, offering Sentinel 2 scenes:
<div class="code"><pre>
i.eodag print=providers producttype=S2_MSI_L2A
<pre></div>

List recognized eodag products:
<div class="code"><pre>
i.eodag print=products
<pre></div>

List recognized eodag products, offered by Copernicus Data Space Ecosystem:
<div class="code"><pre>
i.eodag print=products provider=cop_dataspace
<pre></div>

List queryables for Sentinel 2 scenes, that is offered by Copernicus
Data Space Ecosystem:
<div id="list_queryables_example" class="code"><pre>
i.eodag print=queryables provider=cop_dataspace producttype=S2_MSI_L2A
<pre></div>

List current EODAG configuration:
<div class="code"><pre>
i.eodag print=config
<pre></div>

List current EODAG configuration for Copernicus Data Space Ecosystem:
<div class="code"><pre>
i.eodag print=config provider=cop_dataspace
<pre></div>

<h2>REQUIREMENTS</h2>

<ul>
    <li><a href="https://eodag.readthedocs.io/en/stable/getting_started_guide/install.html">EODAG library</a>
    (install with <code>pip install eodag</code>)</li>
</ul>

<h2>SEE ALSO</h2>

<em>
<a href="i.landsat.html">i.landsat</a>,
<a href="i.sentinel.html">i.sentinel</a>,
<a href="i.modis.html">i.modis</a>
</em>

<h2>AUTHOR</h2>

<a href="https://github.com/HamedElgizery" target="_blank">Hamed Elgizery</a>, Giza, Egypt.<br>
<p>
GSoC 2024 Mentors: Luca Delucchi, Stefan Blumentrath, Veronica Andreo
</p>
