<h2>DESCRIPTION</h2>

<em>r.basin</em> generates the main morphometric parameters of the
basin starting from the digital elevation model and the coordinates
of the basin's closing section (outlet).

<b>Important:</b>

<em>r.basin</em> works in projected locations, geographic or
xy-locations are not supported.

<p>
The closing section's coordinates must belong to the river network
generated by <a href="https://grass.osgeo.org/grass-stable/manuals/r.stream.extract.html">r.stream.extract</a>.
It is suggested to run it beforehand.
In GRASS GIS 7, <em>r.basin</em> has been improved to take in input coordinates not
exactly belonging to the river network (but not too far from it).
It basically snaps to the closest point belonging to the network.
This feature is experimental and might not produce the expected result.
To check if the snapped outlet is acceptable, at the end of the
computation, two outlet vector maps are produced: the one with the
coordinates inserted by the user and the snapped one. If the snapped 
outlet is not acceptable, the user should tweak the coordinates to 
match with the river network.

<h3>Morphometric parameters of basin</h3>

The main parameters are:
<ul>
<li>The coordinates of the vertices of the rectangle containing
the basin.</li>
<li>The center of gravity of the basin: the
coordinates of the pixel nearest to the center of gravity of the
geometric figure resulting from the projection of the basin on the
horizontal plane.</li>
<li>The area of the basin: is the area of a single cell multiplied
by the number of cells belonging to the basin.</li>
<li>The perimeter: is the length of the contour of the figure
resulting by the projection of the basin on the horizontal plane.</li>
<li>Characteristic values of elevation: the highest and the
lowest altitude, the difference between them and the mean elevation
calculated as the sum of the values of the cells divided by the
number of the cells.</li>
<li>The mean slope, calculated averaging the slope map.</li>
<li>The length of the directing vector: the length of the vector
linking the outlet to the center of gravity of the basin.</li>
<li>The prevalent orientation: in GRASS GIS the
aspect categories represent the number degrees of east and they
increase counterclockwise: (90deg is North, 180 is West, 270 is
South 360 is East). The aspect value 0 is used to indicate undefined
aspect in flat areas with slope=0. We instead calculate the
orientation as the number of degrees from north, increasing
counterclockwise.</li>
<li>The length of the main channel: is the length
of the longest succession of segments that connect a source to the
outlet of the basin.</li>
<li>The mean slope of the main channel: it is calculated as follows</li>
</ul>

<br>
<center>
<img src="r_basin1.png" border="0" alt="mean slope">
</center>

<br> where N is the topological diameter, i.e. the number of links
in which the main channel can be divided on the basis of the
junctions.

<ul>
<li>The circularity ratio: is the ratio between the area of the
basin and the area of the circle having the same perimeter of the
basin.</li>
<li>The elongation ratio: is the ratio between the diameter of the
circle having the same area of the basin and the length of the main
channel.
</li>
<li>The compactness coefficient: is the ratio between the perimeter
of the basin and the diameter of the circle having the same area of
the basin.</li>
<li>The shape factor: is the ratio between the area of the basin and
the square of the length of the main channel.</li>
<li>The concentration time (Giandotti, 1934):</li>
</ul>

<br>
<center>
<img src="r_basin2.png" border="0" alt="concentration time">
</center>

<br>where A is the area, L the length of the main channel and H the
difference between the highest and the lowest elevation of the basin.

<ul>
<li>The mean hillslope length: is the mean of the distances
calculated along the flow direction of each point not belonging to
the river network from the point in which flows into the network.
</li>
<li>The magnitude: is the number of the branches of order 1
following the Strahler hierarchy.</li>
<li>The max order: is the order of the basin, following the Strahler
hierarchy.</li>
<li>The number of streams: is the number of the branches of the
river network.</li>
<li>The total stream length: is the sum of the length of every
branch.</li>
<li>The first order stream frequency: is the ratio between the
magnitude and the area of the basin.</li>
<li>The drainage density: is the ratio between the total length of
the river network and the area.</li>
<li>The Horton ratios (Horton, 1945; Strahler, 1957).</li>
</ul>

<h3>Plots</h3>
<ul>
<li>The distance-area function, also known as Width Function: in x
axis is the length and in y axis is the area.</li>
<li>The hypsographic curve provides the distribution of the areas at
different altitudes. Each point on the hypsographic curve has on the
y-axis the altitude and on the x-axis the percentage of basin
surface placed above that altitude.</li>
<li>The hypsometric curve has the same shape but is dimensionless.</li>
</ul>

<h2>EXAMPLE</h2>

North Carolina sample dataset example:

<div class="code"><pre>
g.region raster=elevation -p
r.basin map=elevation prefix=my_basin coord=637304.924954,218617.100523 \
 dir=/tmp/my_basin threshold=1000

# visualize some results
d.mon wx0
d.rast my_basin_elevation_hack

d.rast my_basin_elevation_dist2out

d.his i=aspect h=my_basin_elevation_dist2out
</pre></div>

<p>
<center>
<a href="r_basin_map.png">
<img src="r_basin_map.png" border="0" width="600" alt="r.basin results">
</a>
</center>

<h3>Dependencies</h3>
<ul>
<li>Matplotlib</li>
<li>r.hypso</li>
<li>r.stream.basins</li>
<li>r.stream.distance</li>
<li>r.stream.extract</li>
<li>r.stream.order</li>
<li>r.stream.snap</li>
<li>r.stream.stats</li>
<li>r.width.funct</li>
</ul>

<h2>Known issues</h2>
<ul>
<li>r.basin hasn't been designed for working in lat/long coordinates.
This means that if you are working in lat/long coordinates, you need to reproject
your map first in order to apply the tool.</li>
<li>r.basin is designed to work in meters unit. The values that you get using
feet are nonsense.</li>
<li>r.basin does not handle overwrite. You need to delete the output products
already created (maps, text files, figures) by hand before running it again.</li>
</ul>

<h2>SEE ALSO</h2>

<em>
<a href="r.hypso.html">r.hypso</a> (Addon),
<a href="r.stream.basins.html">r.stream.basins</a> (Addon),
<a href="r.stream.channel.html">r.stream.channel</a> (Addon),
<a href="r.stream.distance.html">r.stream.distance</a> (Addon),
<a href="https://grass.osgeo.org/grass-stable/manuals/r.stream.extract.html">r.stream.extract</a>,
<a href="r.stream.order.html">r.stream.order</a> (Addon),
<a href="r.stream.segment.html">r.stream.segment</a> (Addon),
<a href="r.stream.slope.html">r.stream.slope</a> (Addon),
<a href="r.stream.snap.html">r.stream.snap</a> (Addon),
<a href="r.stream.stats.html">r.stream.stats</a> (Addon),
<a href="https://grass.osgeo.org/grass-stable/manuals/r.watershed.html">r.watershed</a>,
<a href="r.width.funct.html">r.width.funct</a> (Addon)
<br>
Related <a href="https://grasswiki.osgeo.org/wiki/R.basin">Wiki page</a>
</em>

<h2>CITE AS</h2>

Di Leo Margherita, Di Stefano Massimo (2013) An Open-Source Approach for Catchment's
Physiographic Characterization, Abstract H52E-06 presented at 2013 Fall Meeting, AGU,
San Francisco, CA, USA 9-13 Dec.
<a href="http://abstractsearch.agu.org/meetings/2013/FM/sections/H/sessions/H52E/abstracts/H52E-06.html">abstract</a>

<h2>REFERENCES</h2>
<ul>
<li><em>Rodriguez-Iturbe I., Rinaldo A. (2001) Fractal River Basins,
Chance and Self-Organization. Cambridge Press </em></li>
<li><em>In Italian: Di Leo M., Di Stefano M., Claps P., Sole A.
(2010) Caratterizzazione morfometrica del bacino idrografico in
GRASS GIS (Morphometric characterization of the catchment in GRASS
GIS environment), <a href="http://geomatica.como.polimi.it/workbooks/">
Geomatics Workbooks</a>, n. 9</em></li>
</ul>

<h2>AUTHORS</h2>

Margherita Di Leo (grass-dev AT lists DOT osgeo DOT org ), Massimo Di Stefano
