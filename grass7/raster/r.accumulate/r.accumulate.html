<h2>DESCRIPTION</h2>

<em>r.accumulate</em> calculates weighted flow accumulatin, stream networks,
and the longest flow path using a flow direction map.

<h2>NOTES</h2>

Unlike <em>r.watershed</em>, <em>r.accumulate</em> does not require the
elevation data to calculate weigited flow accumulation.  Instead, this module
only uses a flow direction map to trace and accumulate the amount of flow
draining through and including each cell.

<p>With <b>-n</b> flag, the module will count the number of upstream cells plus
one and convert it to the negative if any upstream cells are likely to receive
flow from outside the computational region (flow direction edges). Negative
values identify cells with likely underestimates because not all upstream cells
were accounted for. Since raster map <b>weight</b> may contain negative flow
weights, <b>-n</b> flag is not compatible with <b>weight</b> option.  Running
the module twice with and without <b>-n</b> flag and <b>weight</b> option may
be useful in this specific case.

<p>The module recognizes two different formats of the flow direction map:
<div class="code"><pre>
Direction encoding for neighbors of x

  135  90  45             3 2 1
  180  x  360             4 x 8
  225 270 315             5 6 7

  degrees              45 degrees
  CCW from East        CCW from East
                   (r.watershed drainage)
</pre></div>

<h2>EXAMPLES</h2>

These examples use the North Carolina sample dataset.

<h3>Flow accumulation</h3>

<p>Calculate flow accumulation using <em>r.watershed</em> and
<em>r.accumulate</em>:
<div class="code"><pre>
# set computational region
g.region raster=elevation -p

# calculate positive flow accumulation and drainage directions using r.watershed
r.watershed elevation=elevation accumulation=flow_accum drainage=drain_directions -s -a

# calculate flow accumulation using r.accumulate
r.accumulate direction=drain_directions accumulation=flow_accum_new

# copy color table
r.colors map=flow_accum_new raster=flow_accum

# check difference betwen flow_accum and flow_accum_new
r.mapcalc expression="accum_diff=if(flow_accum-flow_accum_new, flow_accum-flow_accum_new, null())"
</pre></div>

<img src="r_accumulate_nc_example.png">

<p>For some reaon, there are slight differences between the two output maps.

<p><img src="r_accumulate_nc_r_watershed_output.png">

<p>The yellow and purple cells show the difference raster map
(<i>accum_diff</i>). The red arrows and numbers represent drainage directions
(<i>drain_directions</i>) and flow accumulation (<i>flow_accum</i> from
<em>r.watershed</em>), respectively. Note that some cells close to headwater
cells are assigned 1 even if they are located downstream of other cells.

<p><img src="r_accumulate_nc_comparison.png">

<p>For comparison, these numbers show the new flow accumulatoin
(<i>flow_accum_new</i> from <em>r.accumulate</em>). The same cells are properly
accumulated from the headwater cells.

<h3>Stream network delineation</h3>

<p>Calculate flow accumulation and delineate stream networks at once:
<div class="code"><pre>
# use r.accumulate to create flow_accum_new and streams_new at once
r.accumulate direction=drain_directions accumulation=flow_accum_new threshold=50000 stream=streams_new

# or delineate stream networks only without creating an accumulation map
r.accumulate direction=drain_directions threshold=50000 stream=streams_new_only

# use r.stream.extract, elevation, and flow_accum_new to delineate stream networks
r.stream.extract elevation=elevation accumulation=flow_accum_new threshold=50000 stream_vector=streams direction=drain_directions_2
</pre></div>

<img src="r_accumulate_nc_stream_example.png">

<p>In this example, <em>r.accumulate</em> and <em>r.stream.extract</em>
produced slightly different stream networks where the flow turns 90 degrees or
there are multiple downstream cells with the same elevation. The following
figure shows an example where the <i>streams</i> (red from
<em>r.stream.extract</em>) and <i>streams_new</i> (blue from
<em>r.accumulate</em>) vector maps present different stream paths. The numbers
show cell elevations (<i>elevation</i> map), and the yellow
(<i>drain_directions</i> map) and green (<i>drain_directions_2</i> map) arrows
represent flow directions generated by <em>r.watershed</em> with <b>-s</b> flag
and <em>r.stream.extract</em>, respectively. Note that the two flow direction
maps are different.

<p><img src="r_accumulate_nc_stream_comparison.png">

<h2>SEE ALSO</h2>

<em>
<a href="r.watershed.html">r.watershed</a>
</em>

<h2>AUTHOR</h2>

<a href="mailto:grass4u@gmail com">Huidae Cho</a>

<p><i>Last changed: $Date$</i>
